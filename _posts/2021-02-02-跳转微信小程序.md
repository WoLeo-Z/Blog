---
layout:     post
title:      è·³è½¬å¾®ä¿¡å°ç¨‹åº
subtitle:   ç½‘é¡µå¿«æ·è·³è½¬å¾®ä¿¡å°ç¨‹åº
date:       2021-02-02
author:     WoL
header-img: 
catalog: true
tags:
    - ç½‘é¡µè·³è½¬
    - å¾®ä¿¡
---

# è·³è½¬å¾®ä¿¡å°ç¨‹åº

é€šè¿‡å¾®ä¿¡å®˜æ–¹æ–‡æ¡£åˆ¶ä½œå‡ºç½‘é¡µï¼Œå¿«é€Ÿè·³è½¬è¿›å¾®ä¿¡ï¼Œæ‰“å¼€å°ç¨‹åºã€‚

â€”â€”

> æ­¤ç½‘é¡µä»…é™**iPhone**åŠ**iPad**è·³è½¬ï¼Œç”µè„‘ã€å®‰å“å‡ä¸æ”¯æŒã€‚

## DEMO

ç½‘é¡µï¼š[=ç‚¹æˆ‘=](https://woleo-z.github.io/wechat-app/)

> æ‰“å¼€ç½‘é¡µåç‚¹`æ‰“å¼€`ï¼Œå³å¯è·³è½¬ã€‚
> ç½‘é¡µä¸­æ‰“å¼€çš„æ˜¯`å°ç¨‹åºç¤ºä¾‹`å°ç¨‹åºï¼Œæºç åœ¨ä¸‹ï¼Œè‡ªå·±ä¿®æ”¹`appId`ã€`openTagList`ã€`èµ„æºæ–¹ AppID `ã€`èµ„æºæ–¹ç¯å¢ƒ ID `å°±å¯ä»¥ä¿®æ”¹æ‰“å¼€çš„å°ç¨‹åºäº†ã€‚

![è·³è½¬ç¤ºä¾‹](https://i.loli.net/2021/02/03/EIbMzjh5W92go4A.gif)

## æºç 

åœ°å€ï¼š[https://cdn.jsdelivr.net/gh/woleo-z/wechat-app/index.html](https://cdn.jsdelivr.net/gh/woleo-z/wechat-app/index.html)

```
<html>
  <head>
    <title>æ‰“å¼€å°ç¨‹åº</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <script>
      window.onerror = e => {
        console.error(e)
        alert('å‘ç”Ÿé”™è¯¯' + e)
      }
    </script>
    <!-- weui æ ·å¼ -->
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/2.4.1/weui.min.css"></link>
    <!-- è°ƒè¯•ç”¨çš„ç§»åŠ¨ç«¯ console
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script> -->
    <!-- å…¬ä¼—å· JSSDK -->
    <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
    <!-- äº‘å¼€å‘ Web SDK -->
    <script src="https://res.wx.qq.com/open/js/cloudbase/1.1.0/cloud.js"></script>
    <script>
      function docReady(fn) {
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
          fn()
        } else {
          document.addEventListener('DOMContentLoaded', fn);
        }
      }

      docReady(async function() {
        var ua = navigator.userAgent.toLowerCase()
        var isWXWork = ua.match(/wxwork/i) == 'wxwork'
        var isWeixin = !isWXWork && ua.match(/MicroMessenger/i) == 'micromessenger'
        var isMobile = false
        var isDesktop = false
        if (navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|IEMobile)/i)) {
          isMobile = true
        } else {
          isDesktop = true
        }
        console.warn('ua', ua)
        console.warn(ua.match(/MicroMessenger/i) == 'micromessenger')
        var m = ua.match(/MicroMessenger/i)
        console.warn(m && m[0] === 'micromessenger')

        if (isWeixin) {
          var containerEl = document.getElementById('wechat-web-container')
          containerEl.classList.remove('hidden')
          containerEl.classList.add('full', 'wechat-web-container')

          var launchBtn = document.getElementById('launch-btn')
          launchBtn.addEventListener('ready', function (e) {
            console.log('å¼€æ”¾æ ‡ç­¾ ready')
          })
          launchBtn.addEventListener('launch', function (e) {
            console.log('å¼€æ”¾æ ‡ç­¾ success')
          })
          launchBtn.addEventListener('error', function (e) {
            console.log('å¼€æ”¾æ ‡ç­¾ fail', e.detail)
          })

          wx.config({
            // debug: true, // è°ƒè¯•æ—¶å¯å¼€å¯
            appId: 'wxe5f52902cf4de896', 
            timestamp: 0, // å¿…å¡«ï¼Œå¡«ä»»æ„æ•°å­—å³å¯
            nonceStr: 'nonceStr', // å¿…å¡«ï¼Œå¡«ä»»æ„éç©ºå­—ç¬¦ä¸²å³å¯
            signature: 'signature', // å¿…å¡«ï¼Œå¡«ä»»æ„éç©ºå­—ç¬¦ä¸²å³å¯
            jsApiList: ['chooseImage'], // å®‰å“ä¸Šå¿…å¡«ä¸€ä¸ªï¼Œéšæœºå³å¯
            openTagList:['wx-open-launch-weapp'], // å¡«å…¥æ‰“å¼€å°ç¨‹åºçš„å¼€æ”¾æ ‡ç­¾å
          })
        } else if (isDesktop) {
          // åœ¨ pc ä¸Šåˆ™ç»™æç¤ºå¼•å¯¼åˆ°æ‰‹æœºç«¯æ‰“å¼€
          var containerEl = document.getElementById('desktop-web-container')
          containerEl.classList.remove('hidden')
          containerEl.classList.add('full', 'desktop-web-container')
        } else {
          var containerEl = document.getElementById('public-web-container')
          containerEl.classList.remove('hidden')
          containerEl.classList.add('full', 'public-web-container')
          var c = new cloud.Cloud({
            // å¿…å¡«ï¼Œè¡¨ç¤ºæ˜¯æœªç™»å½•æ¨¡å¼
            identityless: true,
            // èµ„æºæ–¹ AppID
            resourceAppid: 'wxe5f52902cf4de896',
            // èµ„æºæ–¹ç¯å¢ƒ ID
            resourceEnv: 'postpay-2g5hm2oxbbb721a4',
          })
          await c.init()
          window.c = c

          var buttonEl = document.getElementById('public-web-jump-button')
          var buttonLoadingEl = document.getElementById('public-web-jump-button-loading')
          try {
            await openWeapp(() => {
              buttonEl.classList.remove('weui-btn_loading')
              buttonLoadingEl.classList.add('hidden')
            })
          } catch (e) {
            buttonEl.classList.remove('weui-btn_loading')
            buttonLoadingEl.classList.add('hidden')
            throw e
          }
        }
      })

      async function openWeapp(onBeforeJump) {
        var c = window.c
        const res = await c.callFunction({
          name: 'public',
          data: {
            action: 'getUrlScheme',
          },
        })
        console.warn(res)
        if (onBeforeJump) {
          onBeforeJump()
        }
        location.href = res.result.openlink
      }
    </script>
    <style>
      .hidden {
        display: none;
      }

      .full {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
      }

      .public-web-container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .public-web-container p {
        position: absolute;
        top: 40%;
      }

      .public-web-container a {
        position: absolute;
        bottom: 40%;
      }

      .wechat-web-container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .wechat-web-container p {
        position: absolute;
        top: 40%;
      }

      .wechat-web-container wx-open-launch-weapp {
        position: absolute;
        bottom: 40%;
        left: 0;
        right: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .desktop-web-container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .desktop-web-container p {
        position: absolute;
        top: 40%;
      }
    </style>
  </head>
  <body>
    <div class="page full">
      <div id="public-web-container" class="hidden">
        <p class="">æ­£åœ¨æ‰“å¼€ â€œå°ç¨‹åºç¤ºä¾‹â€...</p>
        <a id="public-web-jump-button" href="javascript:" class="weui-btn weui-btn_primary weui-btn_loading" onclick="openWeapp()">
          <span id="public-web-jump-button-loading" class="weui-primary-loading weui-primary-loading_transparent"><i class="weui-primary-loading__dot"></i></span>
          æ‰“å¼€å°ç¨‹åº
        </a>
      </div>
      <div id="wechat-web-container" class="hidden">
        <p class="">ç‚¹å‡»ä»¥ä¸‹æŒ‰é’®æ‰“å¼€ â€œå°ç¨‹åºç¤ºä¾‹â€</p>
        <!-- è·³è½¬å°ç¨‹åºçš„å¼€æ”¾æ ‡ç­¾ã€‚æ–‡æ¡£ https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html -->
        <wx-open-launch-weapp id="launch-btn" username="gh_d43f693ca31f" path="/page/component/index">
          <template>
            <button style="width: 200px; height: 45px; text-align: center; font-size: 17px; display: block; margin: 0 auto; padding: 8px 24px; border: none; border-radius: 4px; background-color: #07c160; color:#fff;">æ‰“å¼€å°ç¨‹åº</button>
          </template>
        </wx-open-launch-weapp>
      </div>
      <div id="desktop-web-container" class="hidden">
        <p class="">è¯·åœ¨æ‰‹æœºæ‰“å¼€ç½‘é¡µé“¾æ¥</p>
      </div>
    </div>
  </body>
</html>
```

---

## OKï¼

ğŸ‘Œï¼

